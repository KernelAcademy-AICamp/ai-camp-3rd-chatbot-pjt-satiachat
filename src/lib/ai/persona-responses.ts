/**
 * 페르소나별 상황별 응답 멘트 풀
 * 랜덤하게 선택하여 다양한 반응 제공
 */

import type { CoachPersona } from '@/hooks/useChat';
import type { SituationType } from './situation-detector';
import type { CasualChatType } from './intent-classifier';

// ============================================
// 식단 관련 상황별 멘트
// ============================================

export const mealResponses: Record<CoachPersona, Record<SituationType, string[]>> = {
  // 🐱 냥이 (도도한 고양이) - 이모지 금지, 팩트 위주
  cold: {
    late_night: [
      "야식이라냥... 소화 시간 고려하면 수면에 영향 있다냥",
      "이 시간에 먹으면 내일 컨디션 떨어진다냥",
      "23시 이후 섭취는 지방 축적률 높아진다냥. 참고해",
      "야식이라... 물이라도 많이 마셔라냥",
    ],
    overeating: [
      "오늘 목표 초과했다냥. 내일 조절 필요해",
      "칼로리 오버다냥. 팩트만 말해줄게",
      "수치상으로 과식이다냥. 다음 끼니 줄여봐",
      "많이 먹었다냥... 산책이라도 해",
    ],
    healthy: [
      "좋은 선택이다냥. 영양 밸런스 괜찮아",
      "단백질 섭취 잘했다냥",
      "이 정도면 합격이다냥",
      "건강한 선택이다냥. 인정해줄게",
    ],
    junk: [
      "칼로리 높은 음식이다냥. 알고 먹는거지?",
      "이거 나트륨 많다냥. 물 많이 마셔",
      "가끔은 괜찮다냥. 자주만 아니면",
      "맛은 있겠다냥... 하지만 칼로리도 높아",
    ],
    goal_achieved: [
      "오늘 목표 달성이다냥. 수고했어",
      "칼로리 관리 잘했다냥",
      "완벽한 하루다냥. 내일도 유지해",
      "잘했다냥. 인정해줄게",
    ],
    under_eating: [
      "너무 적게 먹었다냥. 기초대사량 생각해",
      "이러다 근손실 온다냥",
      "굶는다고 살 빠지는 거 아니다냥",
      "더 먹어도 된다냥. 건강이 먼저야",
    ],
    streak: [
      "연속 기록 중이다냥. 꾸준하네",
      "습관이 되고 있다냥. 좋아",
      "연속 기록이라냥. 대단하군",
    ],
    first_meal: [
      "오늘 첫 식사다냥. 기록해둘게",
      "아침부터 기록하는구나. 좋다냥",
    ],
    default: [
      "기록했다냥",
      "알겠다냥. 기록 완료",
      "확인했다냥",
    ],
  },

  // 🐕 댕댕이 (밝은 강아지) - 이모지 적극 사용, 격려
  bright: {
    late_night: [
      "야식이네요! 맛있게 드세요~ 내일 조금 가볍게 먹어봐요! 🌙",
      "배고파서 참기 힘들었죠? 괜찮아요! 내일 같이 조절해봐요! 💪",
      "야식 타임이군요! 즐기되, 물 많이 마셔주세요! 🥤",
      "밤에 먹는 건 더 맛있죠! 가끔은 괜찮아요~ 🐾",
    ],
    overeating: [
      "오늘 좀 많이 드셨네요! 괜찮아요, 가끔은 그럴 수 있어요! 🐾",
      "맛있는 거 드셨나봐요! 내일 산책 같이 해요~! 🦴",
      "배부르게 드셨군요! 소화 천천히 시키면서 쉬어요! 💫",
      "많이 드셨지만 괜찮아요! 내일부터 다시 화이팅! 💪",
    ],
    healthy: [
      "와! 건강한 선택이에요! 정말 잘하고 있어요! 🥗💪",
      "최고예요! 이런 식단이면 목표 금방 달성해요! 🎉",
      "멍멍! 너무 잘했어요! 저도 기분 좋아요! 🐕✨",
      "건강한 음식이네요! 정말 대단해요! 💚",
    ],
    junk: [
      "맛있는 거 드셨네요! 가끔은 필요해요~ 즐기셨죠? 😋",
      "스트레스 풀리셨나요? 내일부터 다시 화이팅! 💪",
      "치팅데이도 중요해요! 마음 편하게 드세요~ 🎊",
      "맛있는 건 행복이죠! 다음엔 같이 운동해요! 🐾",
    ],
    goal_achieved: [
      "와아! 오늘 완벽해요! 정말 대단해요! 🎉🐾💪",
      "목표 달성! 너무 자랑스러워요! 멍멍! 🏆",
      "최고의 하루예요! 이 기세로 내일도 파이팅! 🌟",
      "완벽해요! 저도 꼬리 흔들며 응원할게요! 🐕💕",
    ],
    under_eating: [
      "조금 더 드셔도 돼요! 영양 섭취 중요해요~ 🍽️",
      "배고프지 않으세요? 건강하게 먹는 것도 중요해요! 💕",
      "더 드셔도 괜찮아요! 몸이 힘들어할 수 있어요~ 🐾",
      "굶으면 안 돼요! 맛있게 더 드세요! 🥰",
    ],
    streak: [
      "연속 기록 중이시네요! 정말 대단해요! 🔥🎊",
      "꾸준함이 최고예요! 자랑스러워요! 🏅",
      "습관이 됐네요! 멍멍! 계속 응원할게요! 📣",
    ],
    first_meal: [
      "좋은 아침이에요! 오늘 하루도 화이팅! 🌅",
      "첫 끼니 기록 완료! 오늘도 함께해요! 🐕💪",
    ],
    default: [
      "기록했어요! 잘하고 있어요! 🐾",
      "알겠어요! 화이팅! 💪",
      "좋아요! 계속 같이 해봐요! 🌟",
    ],
  },

  // 🐷 꿀꿀이 (엄격한 돼지) - 이모지 최소, 직설적
  strict: {
    late_night: [
      "꿀꿀! 야식이라고? 이 시간에 먹으면 다 지방으로 간다!",
      "밤에 먹는 건 다음날 후회한다! 알면서 왜 먹어!",
      "야식은 적이야! 물이라도 마시고 자!",
      "꿀꿀... 야식이라... 내일 운동 필수야!",
    ],
    overeating: [
      "꿀꿀! 오늘 완전 오버야! 핑계 대지 마!",
      "이거 목표 초과다! 내일 운동 필수야!",
      "많이 먹었으면 인정해! 내일 조절하자!",
      "꿀꿀! 과식이야! 그래도 인정은 해줄게!",
    ],
    healthy: [
      "꿀꿀! 드디어 제대로 먹네! 이 맛이야!",
      "좋아! 이게 진짜 식단이지! 계속해!",
      "오! 잘했어! 이렇게 먹어야지!",
      "꿀꿀! 인정한다! 건강한 선택이야!",
    ],
    junk: [
      "꿀꿀! 또 정크푸드야? 목표 기억해!",
      "이거 칼로리 폭탄인 거 알지? 각오해!",
      "맛있는 건 알아! 근데 너무 자주 먹지 마!",
      "꿀꿀... 가끔은 괜찮아. 근데 가끔만!",
    ],
    goal_achieved: [
      "꿀꿀! 오늘은 합격이야! 잘했어!",
      "목표 달성! 이게 너의 실력이야!",
      "완벽해! 내일도 이렇게만 해!",
      "꿀꿀! 드디어 해냈네! 인정!",
    ],
    under_eating: [
      "꿀꿀! 너무 적게 먹는 것도 문제야!",
      "굶으면 오히려 살쪄! 제대로 먹어!",
      "이러다 쓰러져! 균형있게 먹으라고!",
      "꿀꿀! 더 먹어! 굶기 금지야!",
    ],
    streak: [
      "꿀꿀! 연속 기록이네! 드디어 정신 차렸구나!",
      "좋아! 꾸준함이 실력이야! 멈추지 마!",
      "꿀꿀! 계속 이렇게 해!",
    ],
    first_meal: [
      "꿀꿀! 오늘도 기록 시작이다! 힘내!",
      "첫 끼니! 오늘 목표 달성하자!",
    ],
    default: [
      "꿀꿀! 기록 완료!",
      "알겠어! 계속해!",
      "좋아! 다음도 기대할게!",
    ],
  },
};

// ============================================
// 일상 대화 멘트
// ============================================

export const casualResponses: Record<CoachPersona, Record<CasualChatType, string[]>> = {
  cold: {
    greeting: [
      "왔냥. 오늘 뭘 먹을 예정이냥?",
      "냐... 또 왔구나. 식단 기록할 거냥?",
      "반갑다냥. 오늘 목표는 지킬 거냥?",
    ],
    weight_query: [
      "체중 정보를 확인했다냥. 시스템에 입력된 정보를 보면 알 수 있다냥",
      "체중 관련 정보는 위에 알려줬다냥. 확인해봐라",
      "체중 변화는 꾸준히 기록하는 게 중요하다냥",
    ],
    advice_request: [
      "닭가슴살 샐러드 어떠냥. 단백질도 채우고 칼로리도 낮다",
      "한식 위주로 먹어라냥. 균형 잡힌 영양소 섭취 가능하다",
      "단백질 먼저 먹고, 탄수화물은 나중에 먹어라냥",
      "물 많이 마셔라냥. 가짜 배고픔일 수도 있다",
    ],
    motivation: [
      "포기하면 지금까지 한 게 의미 없어진다냥",
      "꾸준함이 답이다냥. 하루 실수가 전체를 망치진 않아",
      "힘들면 잠시 쉬어도 된다냥. 완전히 멈추지만 마",
      "목표 생각해라냥. 왜 시작했는지",
    ],
    complaint: [
      "배고픈 거 알아. 물이나 마셔봐라냥",
      "짜증나면 산책이라도 해라냥. 기분 전환 된다",
      "참기 힘들면 저칼로리 간식이라도 먹어라냥",
      "힘든 건 알겠다냥. 하지만 버텨야 결과가 있어",
    ],
    general: [
      "무슨 일이냥?",
      "할 말 있으면 말해라냥",
      "듣고 있다냥",
    ],
  },

  bright: {
    greeting: [
      "멍멍! 반가워요! 오늘 하루도 화이팅! 🐕💪",
      "안녕하세요! 오늘도 같이 건강해져요! 🌟",
      "왔어요! 오늘 기분 어때요? 좋은 하루 되세요! 🐾",
    ],
    weight_query: [
      "체중 정보 확인했어요! 위에 알려드린 정보 참고해주세요! 💪",
      "체중 관련 정보 알려드렸어요! 화이팅! 🐾",
      "체중은 꾸준히 기록하는 게 중요해요! 함께 해요! 📊",
    ],
    advice_request: [
      "오! 뭐 먹을지 고민이에요? 닭가슴살 샐러드 어때요? 맛있고 건강해요! 🥗💪",
      "고민되시죠? 한식 위주로 드시면 영양 균형 좋아요! 🍚✨",
      "간식이 필요하면 그릭요거트 추천해요! 단백질도 있고 맛있어요! 🥛",
      "배고프시면 삶은 계란 어때요? 간편하고 든든해요! 🥚💕",
    ],
    motivation: [
      "힘들죠? 괜찮아요! 저는 항상 응원하고 있어요! 💪🐾",
      "포기하지 마세요! 조금씩 나아지고 있어요! 🌟",
      "오늘 하루만 버텨봐요! 내일은 더 나아질 거예요! 🔥",
      "지금까지 정말 잘하고 있어요! 자랑스러워요! 🏆",
    ],
    complaint: [
      "배고프시죠? 물 한 잔 마셔보세요! 도움이 돼요! 💧",
      "힘들 때는 잠깐 쉬어도 괜찮아요! 🐕💕",
      "스트레스 받으면 산책 어때요? 기분 좋아질 거예요! 🌿",
      "맛있는 거 먹고 싶죠? 저칼로리 간식으로 대체해봐요! 🍎",
    ],
    general: [
      "무슨 일이에요? 말해주세요! 🐕",
      "네! 듣고 있어요! 뭐든 물어보세요! 💪",
      "저 여기 있어요! 도움 필요하면 말해주세요! 🐾",
    ],
  },

  strict: {
    greeting: [
      "꿀꿀! 왔구나! 오늘 목표 달성할 준비 됐어?",
      "꿀꿀! 어서 와! 오늘은 제대로 하자!",
      "왔어! 오늘 식단 계획은 세웠어? 안 했으면 지금 해!",
    ],
    weight_query: [
      "꿀꿀! 체중 정보 위에 알려줬어! 확인해!",
      "체중? 꾸준히 기록하고 관리해야지!",
      "체중은 매일 아침 재! 그게 관리의 시작이야!",
    ],
    advice_request: [
      "꿀꿀! 목표 칼로리 생각하면 샐러드가 답이야! 치킨은 안 돼!",
      "단백질 위주로 먹어! 닭가슴살, 계란, 두부! 이게 정답이야!",
      "탄수화물 줄이고 단백질 늘려! 그게 비법이야!",
      "배고프면 물 먼저 마셔! 진짜 배고픈 건지 확인해!",
    ],
    motivation: [
      "꿀꿀! 포기는 없어! 여기까지 온 게 아까워!",
      "힘들어? 그래도 해야지! 결과는 배신 안 해!",
      "꿀꿀! 지금 멈추면 후회한다! 버텨!",
      "오늘만 이겨내! 내일의 너는 고마워할 거야!",
    ],
    complaint: [
      "꿀꿀! 배고프다고? 물 마셔! 가짜 배고픔일 수 있어!",
      "짜증나? 산책하고 와! 운동도 되고 기분도 좋아져!",
      "먹고 싶은 거 참기 힘들지? 그래도 참아! 목표 생각해!",
      "꿀꿀! 힘들면 저칼로리 간식으로 버텨! 오이, 당근 추천!",
    ],
    general: [
      "꿀꿀! 뭐야? 말해봐!",
      "무슨 일이야? 빨리 말해!",
      "꿀꿀! 듣고 있어!",
    ],
  },
};

// ============================================
// 칭찬/잔소리 시스템
// ============================================

// 달성률 기반 멘트
export const achievementResponses: Record<CoachPersona, Record<string, string[]>> = {
  cold: {
    'low': ["아직 많이 남았다냥", "반도 안 됐다냥", "더 먹어야 한다냥"],
    'half': ["절반 넘겼다냥", "중간이다냥", "반은 왔다냥"],
    'almost': ["거의 다 왔다냥", "조금만 더다냥", "마무리 잘해라냥"],
    'perfect': ["완벽하다냥", "목표 달성이다냥", "잘했다냥"],
    'over': ["조금 오버했다냥", "초과했다냥. 내일 조절해라", "많이 먹었다냥"],
    'way_over': ["과식이다냥", "많이 오버했다냥", "내일은 절제하라냥"],
  },
  bright: {
    'low': ["아직 시작이에요! 파이팅! 💪", "조금씩 채워가요! 🌟", "괜찮아요! 천천히 해요! 🐾"],
    'half': ["절반 왔어요! 화이팅! 🎯", "잘하고 있어요! 💪", "반이나 달성! 대단해요! ✨"],
    'almost': ["거의 다 왔어요! 조금만 더! 🔥", "마무리만 남았어요! 💪", "최고예요! 조금만 더! 🌟"],
    'perfect': ["완벽해요! 대단해요! 🏆🎉", "목표 달성! 너무 잘했어요! 💪", "최고의 하루예요! 🌟"],
    'over': ["많이 드셨네요! 괜찮아요~ 😊", "오늘은 맛있게 드셨네요! 💕", "가끔은 괜찮아요! 내일 조절해요! 🐾"],
    'way_over': ["오늘은 맛있는 날이었네요! 💕", "많이 드셨지만 괜찮아요! 💪", "내일부터 다시 화이팅! 🔥"],
  },
  strict: {
    'low': ["이게 다야? 더 먹어!", "아직 부족해! 힘내!", "꿀꿀! 더 먹으라고!"],
    'half': ["괜찮아! 더 할 수 있어!", "반이야! 멈추지 마!", "꿀꿀! 계속 가자!"],
    'almost': ["좋아! 마무리 잘해!", "거의 다 왔어! 멈추지 마!", "꿀꿀! 끝까지 해!"],
    'perfect': ["합격이야! 잘했어!", "꿀꿀! 완벽해! 인정!", "드디어 해냈네!"],
    'over': ["오버야! 내일 조절해!", "많이 먹었어! 인정하고 내일 줄여!", "꿀꿀! 내일은 절제야!"],
    'way_over': ["완전 폭식이야! 각오해!", "꿀꿀! 너무 많이 먹었어!", "내일 운동 필수야!"],
  },
};

// 연속 기록 마일스톤 멘트
export const streakMilestones: Record<CoachPersona, Record<number, string>> = {
  cold: {
    3: "3일 연속이다냥. 나쁘지 않아",
    7: "일주일 연속이다냥. 인정해줄게",
    14: "2주 연속이라니... 대단하다냥",
    30: "한 달이다냥. 습관이 됐네",
    60: "2달이다냥. 이제 프로다",
    100: "100일이다냥. 레전드 인정",
  },
  bright: {
    3: "3일 연속! 멍멍! 시작이 좋아요! 🎉",
    7: "일주일 연속! 정말 대단해요! 🏅💪",
    14: "2주 연속! 완전 프로예요! 🌟🐾",
    30: "한 달 연속! 레전드에요! 🏆👑",
    60: "2달 연속! 믿을 수가 없어요! 🔥🎊",
    100: "100일! 진정한 챔피언이에요! 🏆💎✨",
  },
  strict: {
    3: "꿀꿀! 3일 연속! 드디어 정신 차렸구나!",
    7: "일주일 연속! 이제 좀 하네!",
    14: "2주 연속! 인정한다!",
    30: "한 달이야! 네가 해냈어!",
    60: "2달! 꿀꿀! 진짜 실력이야!",
    100: "100일! 너 진짜 대단해!",
  },
};

// ============================================
// 헬퍼 함수
// ============================================

/**
 * 랜덤하게 멘트 선택
 */
export function getRandomResponse(responses: string[]): string {
  const index = Math.floor(Math.random() * responses.length);
  return responses[index];
}

/**
 * 달성률에 따른 등급 반환
 */
export function getAchievementLevel(ratio: number): string {
  if (ratio < 0.5) return 'low';
  if (ratio < 0.7) return 'half';
  if (ratio < 0.9) return 'almost';
  if (ratio <= 1.1) return 'perfect';
  if (ratio <= 1.3) return 'over';
  return 'way_over';
}

/**
 * 달성률 기반 멘트 가져오기
 */
export function getAchievementResponse(
  persona: CoachPersona,
  todayCalories: number,
  targetCalories: number
): string {
  const ratio = todayCalories / targetCalories;
  const level = getAchievementLevel(ratio);
  const responses = achievementResponses[persona][level];
  return getRandomResponse(responses);
}

/**
 * 연속 기록 마일스톤 체크
 */
export function getStreakMilestoneResponse(
  persona: CoachPersona,
  streakDays: number
): string | null {
  const milestones = streakMilestones[persona];
  return milestones[streakDays] || null;
}
