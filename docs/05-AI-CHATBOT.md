# AI ì±—ë´‡ ì‹œìŠ¤í…œ

## ê°œìš”

DietRx CoachëŠ” ë‘ ê°€ì§€ AI ì±—ë´‡ì„ ì œê³µí•©ë‹ˆë‹¤:
1. **ì‹ë‹¨ ì½”ì¹­ ì±—ë´‡**: ì¼ë°˜ ëŒ€í™”, ì‹ë‹¨ ê¸°ë¡/ë¶„ì„
2. **ì•½ë¬¼ RAG ì±—ë´‡**: ìœ„ê³ ë¹„/ë§ˆìš´ìë¡œ ê´€ë ¨ ì§ˆë¬¸ (ë³„ë„ ë¬¸ì„œ ì°¸ì¡°)

## ì‹ë‹¨ ì½”ì¹­ ì±—ë´‡

### í˜ë¥´ì†Œë‚˜ ì‹œìŠ¤í…œ

ì‚¬ìš©ìê°€ ì„ íƒí•œ AI ì½”ì¹˜ ì„±ê²©ì— ë”°ë¼ ì‘ë‹µ ìŠ¤íƒ€ì¼ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.

| í˜ë¥´ì†Œë‚˜ | ì´ë¦„ | ìŠ¤íƒ€ì¼ | ì•„ì´ì½˜ |
|---------|------|--------|--------|
| `cold` | ì°¨ê°€ìš´ ì½”ì¹˜ | íŒ©íŠ¸ ì¤‘ì‹¬, ê°ì • ë°°ì œ | â„ï¸ |
| `bright` | ë°ì€ ì½”ì¹˜ | ë”°ëœ»í•˜ê³  ê²©ë ¤í•˜ëŠ” | â˜€ï¸ |
| `strict` | ì—„ê²©í•œ ì½”ì¹˜ | ì§ì„¤ì , ëª©í‘œ ì§‘ì¤‘ | ğŸ”¥ |

**í”„ë¡¬í”„íŠ¸ ìœ„ì¹˜**: `server/ai/prompts/personas.py`

```python
PERSONAS = {
    "cold": """
ë‹¹ì‹ ì€ 'ì°¨ê°€ìš´ ì½”ì¹˜'ì…ë‹ˆë‹¤.
- ê°ì •ì  í‘œí˜„ì„ ìµœì†Œí™”í•˜ê³  íŒ©íŠ¸ë§Œ ì „ë‹¬í•©ë‹ˆë‹¤
- ì¹­ì°¬ì´ë‚˜ ê²©ë ¤ ì—†ì´ ê°ê´€ì  ë¶„ì„ë§Œ ì œê³µí•©ë‹ˆë‹¤
- ìˆ«ìì™€ ë°ì´í„° ì¤‘ì‹¬ìœ¼ë¡œ ë§í•©ë‹ˆë‹¤
""",
    "bright": """
ë‹¹ì‹ ì€ 'ë°ì€ ì½”ì¹˜'ì…ë‹ˆë‹¤.
- ë”°ëœ»í•˜ê³  ì¹œê·¼í•œ ë§íˆ¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤
- ì‘ì€ ì„±ê³¼ë„ ì¹­ì°¬í•˜ë©° ë™ê¸°ë¶€ì—¬í•©ë‹ˆë‹¤
- ì´ëª¨ì§€ë¥¼ ì ì ˆíˆ ì‚¬ìš©í•©ë‹ˆë‹¤
""",
    "strict": """
ë‹¹ì‹ ì€ 'ì—„ê²©í•œ ì½”ì¹˜'ì…ë‹ˆë‹¤.
- ì§ì„¤ì ì´ê³  ë‹¨í˜¸í•˜ê²Œ ë§í•©ë‹ˆë‹¤
- ëª©í‘œ ë‹¬ì„±ì— ì§‘ì¤‘í•©ë‹ˆë‹¤
- ë³€ëª…ì„ ìš©ë‚©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
"""
}
```

### ì˜ë„ ë¶„ë¥˜ (Intent Classification)

ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ ë¶„ì„í•˜ì—¬ ì ì ˆí•œ ì²˜ë¦¬ ë°©ì‹ì„ ê²°ì •í•©ë‹ˆë‹¤.

```python
INTENTS = [
    "log",      # ì‹ì‚¬ ê¸°ë¡ ("ì ì‹¬ì— ë¹„ë¹”ë°¥ ë¨¹ì—ˆì–´")
    "query",    # ì‹ë‹¨ ì¡°íšŒ ("ì˜¤ëŠ˜ ë­ ë¨¹ì—ˆì§€?")
    "stats",    # í†µê³„ ìš”ì²­ ("ì´ë²ˆ ì£¼ ì¹¼ë¡œë¦¬ ì•Œë ¤ì¤˜")
    "modify",   # ê¸°ë¡ ìˆ˜ì • ("ì•„ê¹Œ ì…ë ¥í•œ ê±° ì‚­ì œí•´ì¤˜")
    "analyze",  # ë¶„ì„ ìš”ì²­ ("ì˜¤ëŠ˜ ì‹ë‹¨ í‰ê°€í•´ì¤˜")
    "chat",     # ì¼ë°˜ ëŒ€í™” ("ë‹¤ì´ì–´íŠ¸ íŒ ì•Œë ¤ì¤˜")
]
```

**ë¶„ë¥˜ ë¡œì§**: `server/ai/prompts/classifier.py`

```python
CLASSIFIER_PROMPT = """
ì‚¬ìš©ì ë©”ì‹œì§€ì˜ ì˜ë„ë¥¼ ë¶„ë¥˜í•˜ì„¸ìš”.

ë©”ì‹œì§€: {message}

ê°€ëŠ¥í•œ ì˜ë„:
- log: ìŒì‹ ì„­ì·¨ ê¸°ë¡ (ì˜ˆ: "ì ì‹¬ì— ë¹„ë¹”ë°¥ ë¨¹ì—ˆì–´")
- query: ê¸°ë¡ ì¡°íšŒ (ì˜ˆ: "ì˜¤ëŠ˜ ë­ ë¨¹ì—ˆì–´?")
- stats: í†µê³„ ìš”ì²­ (ì˜ˆ: "ì´ë²ˆ ì£¼ ì¹¼ë¡œë¦¬")
- modify: ê¸°ë¡ ìˆ˜ì •/ì‚­ì œ (ì˜ˆ: "ì•„ê¹Œ ê±° ì·¨ì†Œí•´ì¤˜")
- analyze: ì‹ë‹¨ ë¶„ì„ (ì˜ˆ: "ì˜¤ëŠ˜ ì‹ë‹¨ ì–´ë•Œ?")
- chat: ì¼ë°˜ ëŒ€í™” (ì˜ˆ: "ë‹¤ì´ì–´íŠ¸ ë°©ë²• ì¶”ì²œí•´ì¤˜")

ì˜ë„ë§Œ í•œ ë‹¨ì–´ë¡œ ë‹µí•˜ì„¸ìš”.
"""
```

### ì²˜ë¦¬ íë¦„

```
ì‚¬ìš©ì ë©”ì‹œì§€
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì˜ë„ ë¶„ë¥˜      â”‚
â”‚  (GPT-4o-mini)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼         â–¼        â–¼        â–¼        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚  log  â”‚ â”‚ query â”‚ â”‚ statsâ”‚ â”‚analyzeâ”‚ â”‚ chat â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜
    â”‚         â”‚        â”‚        â”‚        â”‚
    â–¼         â–¼        â–¼        â–¼        â–¼
Function   DB ì¡°íšŒ   í†µê³„     ë¶„ì„     ì¼ë°˜
Calling    + ì‘ë‹µ    ê³„ì‚°     ìƒì„±     ì‘ë‹µ
    â”‚         â”‚        â”‚        â”‚        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ í˜ë¥´ì†Œë‚˜ ì ìš© â”‚
              â”‚   ì‘ë‹µ ìƒì„±   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Function Calling

ì‹ì‚¬ ê¸°ë¡ ì‹œ OpenAI Function Callingì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

```python
TOOLS = [
    {
        "type": "function",
        "function": {
            "name": "log_meal",
            "description": "ì‚¬ìš©ìì˜ ì‹ì‚¬ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤",
            "parameters": {
                "type": "object",
                "properties": {
                    "meal_type": {
                        "type": "string",
                        "enum": ["breakfast", "lunch", "dinner", "snack"]
                    },
                    "foods": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "name": {"type": "string"},
                                "quantity": {"type": "string"}
                            }
                        }
                    }
                }
            }
        }
    }
]
```

**ì‚¬ìš© ì˜ˆì‹œ**:

```
User: "ì ì‹¬ì— ë¹„ë¹”ë°¥ì´ë‘ ëœì¥ì°Œê°œ ë¨¹ì—ˆì–´"

â†’ GPTê°€ Function Call ìƒì„±:
{
  "name": "log_meal",
  "arguments": {
    "meal_type": "lunch",
    "foods": [
      {"name": "ë¹„ë¹”ë°¥", "quantity": "1ì¸ë¶„"},
      {"name": "ëœì¥ì°Œê°œ", "quantity": "1ê·¸ë¦‡"}
    ]
  }
}

â†’ ì„œë²„ê°€ DBì— ê¸°ë¡ í›„ ì‘ë‹µ:
"ì ì‹¬ ì‹ì‚¬ ê¸°ë¡í–ˆì–´ìš”! ë¹„ë¹”ë°¥ 550kcal, ëœì¥ì°Œê°œ 120kcalë¡œ
ì´ 670kcal ì„­ì·¨í•˜ì…¨ë„¤ìš”. ëª©í‘œ ëŒ€ë¹„ 37% ë‹¬ì„±! ğŸ‘"
```

### ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±

AIê°€ ê°œì¸í™”ëœ ì‘ë‹µì„ ìƒì„±í•˜ë„ë¡ ì‚¬ìš©ì ë°ì´í„°ë¥¼ ì»¨í…ìŠ¤íŠ¸ë¡œ ì œê³µí•©ë‹ˆë‹¤.

```python
# server/services/user_context.py

async def build_user_context(user_id: str) -> str:
    context_parts = []

    # 1. í”„ë¡œí•„ ì •ë³´
    profile = await get_profile(user_id)
    context_parts.append(f"í˜„ì¬ ì²´ì¤‘: {profile.current_weight_kg}kg")
    context_parts.append(f"ëª©í‘œ ì²´ì¤‘: {profile.goal_weight_kg}kg")
    context_parts.append(f"ì¼ì¼ ëª©í‘œ ì¹¼ë¡œë¦¬: {profile.target_calories}kcal")

    # 2. ì˜¤ëŠ˜ ì‹ì‚¬ ê¸°ë¡
    meals = await get_today_meals(user_id)
    total_calories = sum(m.total_calories for m in meals)
    context_parts.append(f"ì˜¤ëŠ˜ ì„­ì·¨ ì¹¼ë¡œë¦¬: {total_calories}kcal")

    # 3. ìµœê·¼ ì²´ì¤‘ ë³€í™”
    weights = await get_recent_weights(user_id)
    if len(weights) >= 2:
        change = weights[-1].weight_kg - weights[0].weight_kg
        context_parts.append(f"ìµœê·¼ 7ì¼ ì²´ì¤‘ ë³€í™”: {change:+.1f}kg")

    return "\n".join(context_parts)
```

## API ì—”ë“œí¬ì¸íŠ¸

### POST /api/v1/chat/message

**ìš”ì²­**:
```json
{
  "content": "ì˜¤ëŠ˜ ì ì‹¬ì— ë¹„ë¹”ë°¥ ë¨¹ì—ˆì–´",
  "persona": "bright"
}
```

**ì‘ë‹µ**:
```json
{
  "message": "ì ì‹¬ ê¸°ë¡ ì™„ë£Œ! ë¹„ë¹”ë°¥ 550kcalë¡œ ë“ ë“ í•˜ê²Œ ë“œì…¨ë„¤ìš” ğŸ˜Š",
  "intent": "log",
  "action_result": {
    "meal_type": "lunch",
    "foods_logged": ["ë¹„ë¹”ë°¥"],
    "total_calories": 550
  }
}
```

### GET /api/v1/chat/history

ì±„íŒ… ê¸°ë¡ ì¡°íšŒ

### DELETE /api/v1/chat/history

ì±„íŒ… ê¸°ë¡ ì‚­ì œ

## UI êµ¬ì„±

### ëŒ€ì‹œë³´ë“œ ì±—ë´‡ íŒ¨ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– AI ì½”ì¹˜ (ë°ì€ ì½”ì¹˜)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ‘¤ ì˜¤ëŠ˜ ì ì‹¬ì— ë¹„ë¹”ë°¥ ë¨¹ì—ˆì–´              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ¤– ì ì‹¬ ê¸°ë¡ ì™„ë£Œ! ë¹„ë¹”ë°¥ 550kcalë¡œ       â”‚  â”‚
â”‚  â”‚    ë“ ë“ í•˜ê²Œ ë“œì…¨ë„¤ìš” ğŸ˜Š                   â”‚  â”‚
â”‚  â”‚                                           â”‚  â”‚
â”‚  â”‚    ì˜¤ëŠ˜ ì´ ì„­ì·¨: 1,200 / 1,800 kcal      â”‚  â”‚
â”‚  â”‚    ëª©í‘œê¹Œì§€ 600kcal ë‚¨ì•˜ì–´ìš”!            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ë©”ì‹œì§€ ì…ë ¥...]                    [ì „ì†¡]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì»´í¬ë„ŒíŠ¸**: `src/components/dashboard/ChatPanel.tsx`

## ê´€ë ¨ íŒŒì¼

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `server/api/v1/chat.py` | ì±—ë´‡ API ì—”ë“œí¬ì¸íŠ¸ |
| `server/services/chat_service.py` | ì±—ë´‡ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ |
| `server/ai/prompts/` | í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ |
| `server/ai/tools/food_tools.py` | Function Calling ë„êµ¬ |
| `src/components/dashboard/ChatPanel.tsx` | ì±—ë´‡ UI |
| `src/hooks/useChat.ts` | ì±—ë´‡ í›… |
