"""
DietRx Coach 프로젝트 발표 PPT 생성
템플릿 기반 수정
"""
from pptx import Presentation
from pptx.util import Inches, Pt
from pptx.dml.color import RGBColor
from pptx.enum.text import PP_ALIGN
import os

# 템플릿 경로
TEMPLATE_PATH = r"c:\Users\djgus\Downloads\[커널아카데미] AI 심화 캠프_Chat Bot 프로젝트 발표 템플릿(수강생용).pptx"
OUTPUT_PATH = r"c:\Users\djgus\Downloads\DietRx_Coach_발표자료.pptx"

# 프레젠테이션 로드
prs = Presentation(TEMPLATE_PATH)

def replace_text_in_shape(shape, replacements):
    """도형 내 텍스트 치환"""
    if not shape.has_text_frame:
        return
    for paragraph in shape.text_frame.paragraphs:
        for run in paragraph.runs:
            for old, new in replacements.items():
                if old in run.text:
                    run.text = run.text.replace(old, new)

def replace_text_in_slide(slide, replacements):
    """슬라이드 내 모든 텍스트 치환"""
    for shape in slide.shapes:
        replace_text_in_shape(shape, replacements)
        # 그룹 도형 처리
        if shape.has_table:
            for row in shape.table.rows:
                for cell in row.cells:
                    for paragraph in cell.text_frame.paragraphs:
                        for run in paragraph.runs:
                            for old, new in replacements.items():
                                if old in run.text:
                                    run.text = run.text.replace(old, new)

# 슬라이드별 텍스트 치환
slide_replacements = {
    # Slide 1 - 타이틀
    0: {
        "LLM API를 활용한 학습 보조 챗봇 개발": "GLP-1 사용자를 위한 AI 다이어트 코칭 챗봇",
        "팀 이름 입력": "DietRx Coach",
        "2025. 11. 12 (수)": "2025. 12. 10 (화)",
    },
    # Slide 2 - 팀원 소개
    1: {
        "팀원캠": "어현우",
    },
    # Slide 3 - 프로젝트 개요
    2: {
        "학습 효율 향상을 위한 보조 챗봇 개발": "GLP-1 약물 사용자를 위한 AI 다이어트 코칭 플랫폼",
        "요약, Q&A, 문제 생성, 자료 추천": "식단 기록, 약물 Q&A, 복용 관리, AI 코칭",
        "GPT-4o, Claude 3": "GPT-4o-mini, LlamaIndex RAG",
        "FastAPI + Streamlit + LLM API": "React + FastAPI + Supabase",
        "텍스트 입력": "메시지 입력",
        "처리 및 분석": "Intent 분류",
        "AI 응답 생성": "Function Calling",
        "학습 지원": "식단 기록",
    },
    # Slide 4 - 프로젝트 일정
    3: {
        "2025.11.6 ~ 2025.11.12 (1주)": "2025.12.04 ~ 2025.12.10 (1주)",
        "11.6 (Day 1)": "12.4 (Day 1)",
        "11.7-8 (Day 2-3)": "12.5-6 (Day 2-3)",
        "11.9 (Day 4)": "12.7 (Day 4)",
        "11.10 (Day 5)": "12.8 (Day 5)",
        "11.11-12 (Day 6-7)": "12.9-10 (Day 6-7)",
        "요약 & Q&A 기능 개발": "AI 챗봇 & 식단 기록",
        "통합 테스트 & 발표 준비": "RAG 시스템 구축",
        "초기 환경 설정": "프로젝트 초기 설정",
        "문제 생성 기능 추가": "약물 관리 기능",
        "자료 추천 기능 추가": "UI 개선 & 로고",
        "전체 기능 테스트, 오류 수정, 발표 자료 준비": "전체 통합 및 최종 테스트",
        "개발 환경 설정, API 연결 테스트, 기본 구조": "Supabase 연동, 온보딩 구현",
        "객관식/주관식 문제 자동 생성 기능 구현": "약물 스케줄링, 달력 UI",
        "관련 자료, 논문, 기사 추천 기능 구현": "SatiaChat 로고 적용, 사이드바 개선",
        "텍스트 요약, 자동 Q&A 생성 기능 구현 및 테스트": "페르소나 챗봇, Function Calling 구현",
        "기본 기능(요약, Q&A) 완성 우선": "핵심 기능 완성 우선",
        "각 단계별 품질 테스트 진행": "단계별 테스트 진행",
        "주간 별 진행 상황 공유": "매일 진행 상황 공유",
    },
    # Slide 5 - 서비스 주요 기능
    4: {
        "텍스트 요약 & Q&A 생성": "AI 식단 코칭 챗봇",
        "맞춤형 문제 자동 생성": "RAG 기반 약물 Q&A",
        "관련 학습 자료 추천": "약물 복용 스케줄 관리",
        "텍스트 데이터를 5줄로 요약하고 핵심 내용에 대한 질문과 답변 세트를 자동 생성": "3가지 페르소나(차가운/밝은/엄격한) 중 선택하여 자연어로 식단 기록 및 코칭",
        "입력된 학습 내용 기반으로 객관식/주관식 문제 및 정답 해설 자동 생성": "식약처 공식 문서 기반 위고비/마운자로 부작용, 용법 등 Q&A",
        "학습 내용과 관련된 추가 논문, 기사, 참고 자료를 자동으로 검색하여 추천": "주 1회 GLP-1 약물 복용 일정을 달력으로 관리하고 기록",
        "텍스트 요약 (5줄)": "식단 기록 기능",
        "1. 인공지능은 대량 대용량의 데이터를 통해 패턴을 인식하고 학습합니다.": "1. \"점심에 비빔밥 먹었어\" → 자동으로 칼로리/영양소 기록",
        "2. 딥러닝 기술은 여러 신경망 계층을 통해 복잡한 문제를 해결합니다.": "2. 11,086개 한국 음식 DB 기반 영양 정보 자동 매칭",
        "3. 자연어 처리는 인간가 더 자연스럽게 상호작용하는 기술입니다.": "3. 페르소나별 맞춤 피드백 (팩트형/격려형/직설형)",
        "4. LLM은 방대한 양의 텍스트데이터를 학습하여 다양한 텍스트 생성 작업을 수행합니다.": "4. 오늘의 칼로리 섭취량 자동 계산 및 목표 대비 현황",
        "5. 최신 AI 모델들은 문맥 이해와 추론 생성 능력이 크게 개선되었습니다.": "5. 체중 변화 추이 분석 및 개인화된 조언 제공",
        "Q&A 생성": "약물 RAG Q&A",
        "문제 생성": "달력 기록",
        "자료 추천": "복용 알림",
        "학습 보조 챗봇 – 서비스 화면": "DietRx Coach – 서비스 화면",
    },
    # Slide 6 - 사용자 흐름
    5: {
        "문서 업로드": "메시지 입력",
        "Q&A 생성": "Intent 분류",
        "챗봇 결과 확인": "Function Calling",
        "(차트/표/텍스트)": "(식단 자동 기록)",
        "핵 학습 시작": "AI 응답 생성",
        "(5줄 요약)": "(페르소나 적용)",
        "관련 자료 추천": "데이터 저장",
        "문제 풀기": "대시보드 확인",
        "연 심화 학습 진행": "칼로리/체중 확인",
        "연 객관식/주관식 풀기": "약물 복용 기록",
        "사용자는 학습 문서를 통해 요약, Q&A, 문제 생성, 자료 추천 기능을 선택하고 활용하여 활용할 수 있습니다.": "사용자는 AI 챗봇으로 식단 기록, 약물 Q&A, 복용 관리를 편리하게 이용할 수 있습니다.",
    },
    # Slide 7 - 서비스 아키텍처
    6: {
        "사용자 인터페이스, 백엔드 서버, 외부 API를 분리한 확장 가능한 아키텍처": "React 프론트엔드, Supabase BaaS, FastAPI AI 서버의 하이브리드 아키텍처",
        "Streamlit UI": "React + Vite",
        "FastAPI": "Supabase + FastAPI",
        "OpenAI / Claude": "OpenAI + LlamaIndex",
        "사용자 인터페이스 및 시각화": "React UI + TanStack Query",
        "프롬프트 구성 & API 호출": "Supabase Auth/DB + FastAPI AI",
        "LLM 텍 추론 및 응답 생성": "GPT-4o-mini + RAG 검색",
        "사용자": "사용자",
        "문서 업로드": "채팅 입력",
        "백엔드 처리": "Intent 분류",
        "LLM 호출": "AI 응답",
        "결과 출력": "DB 저장",
        "확장성 확보": "확장성 확보",
        "보안성 강화": "Supabase RLS",
        "역할별 및 교체": "마이크로서비스",
    },
    # Slide 8 - 데이터 흐름도
    7: {
        "사용자의 입력부터 결과 출력까지의 4단계 데이터 처리 흐름:": "사용자 메시지 입력부터 응답까지의 데이터 처리 흐름:",
        "1. 사용자 입력": "1. 메시지 입력",
        "2. Backend 요청": "2. Intent 분류",
        "3. LLM API 호출": "3. Function Calling",
        "4. 결과 파싱 & 출력": "4. 응답 생성",
        "차트, 표, 텍스트 등": "식단/약물 Intent",
        "FastAPI 서버에서": "GPT가 함수 호출",
        "OpenAI/Claude API로": "DB 저장 + 응답",
        "결과 데이터 파싱 후": "페르소나 적용 응답",
        "문서 업로드": "채팅 메시지",
        "프롬프트 구성": "Supabase 저장",
        "응답 결과 수신": "React UI 표시",
        "Streamlit UI에 표시": "실시간 업데이트",
        "입력 데이터 처리": "메시지 처리 흐름",
        "출력 데이터 처리": "응답 처리 흐름",
        "↘ 사용자가 업로드한 텍스트를 분석": "↘ 사용자 메시지의 Intent를 분류",
        "↘ LLM API 응답 JSON 파싱": "↘ log/query/stats/analyze/chat 분류",
        "↘ 오류 발생 시 재시도 및 전처리": "↘ Function Calling으로 식단 자동 기록",
        "↘ 결과 포맷에 따라 UI 렌더링 결정 선택": "↘ 페르소나가 적용된 응답 생성",
        "↘ Backend로 정형화된 요청을 전달": "↘ Supabase DB에 데이터 저장",
        "↘ 사용자 친화적 형태로 가공하여 표시": "↘ React UI에 실시간 반영",
    },
    # Slide 9 - 기술 스택
    8: {
        "Streamlit": "React 18",
        "인터랙티브 UI 컴포넌트": "TypeScript + Vite",
        "FastAPI (Python)": "FastAPI + Supabase",
        "프롬프트 구성 & API 호출": "AI 처리 + BaaS",
        "OpenAI (GPT-4o)": "OpenAI GPT-4o-mini",
        "Anthropic (Claude 3)": "LlamaIndex RAG",
        "Python 3.9+": "Node.js 18+",
        "Docker (선택)": "Python 3.11+",
        "Slack": "Supabase Cloud",
        "Notion": "GitHub",
    },
    # Slide 10 - 주요 기능 시연 설명 1
    9: {
        "요약 기능": "AI 식단 기록",
        "Q&A 기능": "페르소나 코칭",
        "입력 텍스트를 5줄로 요약하여 핵심 내용을 쉽게 파악할 수 있습니다.": "자연어로 \"점심에 비빔밥 먹었어\"라고 입력하면 자동으로 칼로리가 기록됩니다.",
        "학습 내용에 대한 질문과 답변 세트를 자동으로 생성합니다.": "3가지 페르소나 중 선택하여 개인화된 식단 피드백을 받습니다.",
        "입력 텍스트 → 5줄 요약": "사용자 메시지 → 식단 기록",
        "자동 질문/답변 세트": "페르소나별 피드백",
        "예시: 인공지능이 교육의 미래를 이끌어갈 가능성에 대한 미 분석 기사 (2500자)": "예시: \"오늘 점심에 비빔밥이랑 된장찌개 먹었어\"",
        "Q1: 인공지능이 교육에 미치는 가장 큰 변화는 무엇인가?": "→ 점심 기록 완료! 비빔밥 550kcal, 된장찌개 120kcal",
        "A: 개인화된 학습 경험의 제공과 실시간 피드백 기능이다. 학습자는 자신에 맞추어 최적화된 학습 경로를 제공받을 수 있게 되었다.": "총 670kcal 섭취하셨네요. 목표 대비 37% 달성! 👍",
        "요약:": "밝은 코치:",
        "AI 기술은 개인화된 학습 경험을 제공한다.": "잘하고 계세요! 균형 잡힌 한식이네요 😊",
        "Q2: 교사들의 역할 변화는 어떻게 이루어지고 있는가?": "차가운 코치:",
        "자연어 처리 기술은 실시간 피드백을 가능하게한다.": "670kcal. 목표 1800kcal 중 37% 섭취.",
        "교사의 역할은 지식 전달에서 학습 가이드로 변화하고 있다. AI가 기본 설명과 피드백을 제공하는 동안, 교사는 학생의 이해와 창의적 사고에 집중할 수 있게 되었다.": "엄격한 코치: 점심에 670kcal면 적당해요. 저녁에 과식하지 마세요!",
        "그러나, 접근성 이슈는 여전히도 존재한다.": "",
    },
    # Slide 11 - 주요 기능 시연 설명 2
    10: {
        "문제 생성 기능": "RAG 약물 Q&A",
        "자료 추천 기능": "약물 복용 관리",
        "학습 내용을 기반으로 객관식/주관식 문제를 자동 생성합니다.": "식약처 공식 문서 기반으로 위고비/마운자로 질문에 답변합니다.",
        "학습 내용과 관련된 추가 자료를 자동으로 추천합니다.": "주 1회 GLP-1 약물 복용을 달력으로 관리합니다.",
        "객관식 문제 3개": "약물 Q&A 예시",
        "관련 논문/기사 링크": "복용 달력 기능",
        "문제 1: 다음 중 LLM(대규모 언어 모델)의 특징이 아닌 것은?": "Q: 위고비 부작용이 뭐야?",
        "교육 분야에서의 LLM 활용 사례 연구": "A: 위고비(세마글루타이드)의 주요 부작용은",
        "방대한 양의 텍스트 데이터로 학습된다.": "오심(구역질), 구토, 설사, 변비, 복통 등",
        "한국인공지능학회지, 2025년 8월호": "위장관계 이상반응입니다.",
        "자연어 처리 능력이 뛰어나다.": "(출처: wegovy_주의사항.txt)",
        "AI 기반 학습 시스템의 효과성에 대한 최신 리포트": "",
        "이미지 처리에 특화되어 있다.": "● 복용 완료 (12/3, 12/10)",
        "교육정책연구원, 2025년 교육기술동향": "○ 복용 예정 (12/17)",
        "문맥을 이해하고 응답을 생성한다.": "✗ 미복용 (12/24)",
        "정답: C": "이번 달 복용률: 85%",
        "문제 2: 인공지능 학습 지원 시스템의 주요 장점은?": "",
        "높은 학습 경로 수정 2025 동향 보고서": "",
        "학습자의 필요성에 맞게 교체한다.": "",
        "개인화된 학습 경험을 제공한다.": "",
        "모든 학생에게 동일한 학습 경로를 제공한다.": "",
        "인터넷 연결 없이도 작동한다.": "",
        "정답: B": "",
    },
    # Slide 12 - 기대 효과
    11: {
        "효율적인 학습 & 이해도 향상": "식단 관리 자동화",
        "시험/문제 준비 자동화": "약물 정보 신뢰성",
        "학습자가 핵심 내용을 쉽게 파악하고 질문-답변을 통해 이해도를 확인할 수 있습니다.": "자연어 입력만으로 칼로리/영양소가 자동 기록되어 편리합니다.",
        "학습 내용 기반으로 객관식/주관식 문제가 자동 생성되어 효율적인 시험 준비가 가능합니다.": "식약처 공식 문서 기반 RAG로 정확한 약물 정보를 제공합니다.",
        "심화 학습 지원": "개인화된 코칭",
        "다양한 자료의 활용성 확대": "복용 관리 간편화",
        "관련 논문/기사 추천을 통해 학습 내용과 관련된 추가 자료를 쉽게 찾을 수 있습니다.": "3가지 페르소나로 사용자 성향에 맞는 코칭을 받습니다.",
        "다양한 형태의 학습 자료를 효과적으로 활용하여 실제 성적에서도 높은 상용됩니다.": "달력 기반 주 1회 복용 스케줄로 약물 관리가 쉽습니다.",
        "LLM API를 활용한 학습 보조 챗봇은 개인화된 학습 경험을 제공하고": "DietRx Coach는 GLP-1 사용자의 식단 관리를 자동화하고",
        "학습자의 자기주도적 학습 능력 향상 기여할 것으로 예상됩니다.": "AI 코칭으로 건강한 체중 관리를 지원합니다.",
    },
    # Slide 13 - 마무리
    12: {
        "프로젝트 완성": "프로젝트 완성",
        "LLM 기반 학습 보조 챗봇 프로토타입 완성": "GLP-1 사용자를 위한 AI 다이어트 코칭 플랫폼 완성",
        "OpenAI와 Claude API를 활용한 학습 지원 서비스의 핵심 기능 구현 완료": "GPT-4o-mini + LlamaIndex RAG 기반 식단/약물 관리 시스템 구현",
        "향후 발전 방향": "향후 발전 방향",
        "PDF, 이미지 입력 지원": "음성 입력 지원",
        "사용자 맞춤형 추천 고도화": "운동 기록 연동",
        "학습 이력 추적 기능 추가": "의료진 연동 기능",
        "다양한 형태의 학습 자료 입력 지원으로 활용성 확대": "음성으로 식단 기록이 가능하도록 STT 연동",
        "개인 학습 패턴 분석을 통한 최적의 자료와 문제 추천": "운동 칼로리 소모량 연동으로 종합 건강 관리",
        "학습 활동 기록 및 분석을 통한 효과적인 학습 계획 수립 지원": "처방 의료진과 데이터 공유 기능 추가",
    },
    # Slide 14 - 회고
    13: {
        "개인별 별 회고 작성": "프로젝트 회고",
        "팀원캠": "어현우 / 김혜민",
    },
}

# 각 슬라이드에 치환 적용
for slide_idx, replacements in slide_replacements.items():
    if slide_idx < len(prs.slides):
        replace_text_in_slide(prs.slides[slide_idx], replacements)

# 저장
prs.save(OUTPUT_PATH)
print(f"프레젠테이션이 저장되었습니다: {OUTPUT_PATH}")
